#!/usr/bin/env node

var scriptsP = require('../index');

var errorOut = function(msg){
  console.error('[error]', msg);
  process.exit(1);
};

try{
  var package_json = require(process.cwd() + '/package.json');
}catch(e){
  errorOut('must be run in the same working directory as your package.json');
}
var scripts = (package_json && package_json.scripts) || {};

var raw = false;
var npm_script_names = [];

process.argv.slice(2).forEach(function(script){
  if(script === "-r" || script === "--raw"){
    raw = true;
    return;
  }
  if(!scripts.hasOwnProperty(script)){
    errorOut('"' + script + '" not found in package.json scripts');
    return;
  }
  npm_script_names.push(script);
});

if(npm_script_names.length === 0){
  console.log();
  console.log("USAGE: scriptsp [--raw] <script1> <script2> ...");
  console.log();
  console.log("    -r, --raw");
  console.log("        simply pipe the output from the scripts, no fancy output stuff");
  console.log();
  console.log("i.e.");
  console.log("    $ scriptsp start test watch-js");
  console.log();
  process.exit(0);
}

scriptsP(npm_script_names, raw);
